<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/default}">

<body>


<div layout:fragment="content1">
    <div class="breadcrumb breadcrumb-style-one mb-0 ">
        <div class="container">
            <div class="col-lg-12 text-center">
                <h1 class="breadcrumb-title">로그인</h1>
                <ul class="d-flex justify-content-center breadcrumb-items">
                    <li class="breadcrumb-item"><i class="bi bi-house-door"></i> <a th:href="@{/}">Home</a>
                    <li class="breadcrumb-item active">로그인</li>
                </ul>
            </div>
        </div>
    </div>


    <section class="register-section pt-110">
        <div class="container">
            <div class="row d-flex justify-content-center text-center">
                <div class="col-12">
                    <div class="register-btn-group">
                        <a th:href="@{/member/register}" class="register-btn style2">회원가입</a>
                        <a th:href="@{/auth/login}" class="login-btn style2">로그인</a>
                    </div>
                </div>
            </div>

            <div class="right-form-area">
                <h3>Login Your Account</h3>
                <form id="loginForm" class="w-100" method="post">
                    <div class="form-inner">
                        <label>이메일</label>
                        <input type="text" name="email" placeholder="Your email">
                    </div>
                    <div class="form-inner">
                        <label>비밀번호</label>
                        <input type="password" name="password" id="password" placeholder="Password"/>
                        <i class="bi bi-eye-slash" id="togglePassword"></i>
                    </div>
<!--                    <div class="form-inner d-flex justify-content-between flex-wrap">-->
<!--                        <div class="form-group">-->
<!--                            <input type="checkbox" id="html">-->
<!--                            <label for="html">Remember Me</label>-->
<!--                        </div>-->
<!--                        <a href="#" class="forgot-pass">Forgotten Password</a>-->
<!--                    </div>-->
                    <input type="submit" value="로그인" class="account-btn">
                </form>

<!--                <div class="alternate-signup-box">-->
<!--                    <h6>or Sign up WITH</h6>-->
<!--                    <div class="btn-group gap-4">-->
<!--                        <a href="" class="google-btn d-flex align-items-center"><i-->
<!--                                class='bx bxl-google'></i><span>Sign up with google</span></a>-->
<!--                        <a href="" class="facebook-btn d-flex align-items-center"><i-->
<!--                                class='bx bxl-facebook'></i>Sign up with facebook</a>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
        </div>

    </section>
    <!-- 알림 메시지 -->
    <div id="alert-box" style="display:none; position:fixed; top:20px; right:20px; z-index:1000; padding:10px; background-color:#f0ad4e; color:white; border-radius:5px;">
        <span id="alert-message"></span>
    </div>

    <script>
    let accessToken = "";
    const form = document.getElementById("loginForm");

    form.addEventListener("submit", function(event) {
        event.preventDefault();  // 기본 폼 제출을 막음

        const formData = new FormData(form);  // 폼 데이터를 FormData로 준비

        fetch('[[@{/auth/login}]]', {
            method: "POST",
            credentials: "include",
            body: formData
        })
        .then(response => {
            if (response.ok) {
                // 로그인 성공
                const accessToken = response.headers.get('Authorization');
                localStorage.setItem("accessToken", accessToken);
                showAlert("로그인 성공!");
                window.location.href = '[[@{/auction}]]';
            } else {
                showAlert("로그인 실패. 다시 시도해주세요.");
            }
        })
        .catch(error => console.error("폼 제출 에러:", error));
    })

    // 로그인 결과에 따른 알림 메시지 표시
    // window.onload = function() {
        /* 서버에서 로그인 성공 또는 실패 여부에 대한 정보를 받기 위한 Thymeleaf 코드 */
        /* 예: 서버에서 model.addAttribute("loginSuccess", true 또는 false); 를 사용하여 결과 전달 */
        /* 아래 코드에서 loginSuccess 및 loginFailure는 서버에서 전달받는 속성이라고 가정 */

        /* 로그인 성공 알림 */
        // var loginSuccess = /*[[${loginSuccess}]]*/ false; // 서버에서 제공하는 값
        // if (loginSuccess) {
        // showAlert("로그인 성공!");
        // }

        /* 로그인 실패 알림 */
        // var loginFailure = /*[[${loginFailure}]]*/ false; // 서버에서 제공하는 값
        // if (loginFailure) {
        // showAlert("로그인 실패. 다시 시도해주세요.");
        // }
    // }

    // 알림 메시지 표시 함수
    function showAlert(message) {
        var alertBox = document.getElementById("alert-box");
        var alertMessage = document.getElementById("alert-message");
        alertMessage.textContent = message;
        alertBox.style.display = "block";

        // 3초 후 알림 메시지 자동 닫기
        setTimeout(function () {
            alertBox.style.display = "none";
        }, 3000);
    }
    </script>


</div>
</body>
</html>